 # Local LLM API Server Development Log

## 2025-08-21 - Phase 1 μ™„λ£: OpenAI νΈν™ API μ„λ²„ κµ¬μ¶•

### β… μ™„μ„±λ κΈ°λ¥λ“¤

#### ν•µμ‹¬ μ•„ν‚¤ν…μ²
- **FastAPI κΈ°λ° REST API μ„λ²„** κµ¬μ¶•
- **OpenAI Chat Completions API μ™„μ „ νΈν™**
- **MLX-LM λ°±μ—”λ“** μ—°λ™μΌλ΅ Apple Silicon μµμ ν™”
- **Pydantic λ°μ΄ν„° λ¨λΈ** κΈ°λ° νƒ€μ… μ•μ „μ„±

#### API μ—”λ“ν¬μΈνΈ
```
GET  /                      - μ„λ²„ μƒνƒ ν™•μΈ
POST /v1/chat/completions  - OpenAI νΈν™ μ±„ν… μ™„λ£ API
```

#### μ£Όμ” λ¨λΈ λ° κµ¬μ΅°
- `ChatCompletionRequest`: OpenAI μ”μ²­ μ¤ν™ μ™„μ „ νΈν™
- `ChatCompletionResponse`: OpenAI μ‘λ‹µ μ¤ν™ μ™„μ „ νΈν™  
- `ModelManager`: λ¨λΈ μƒλ…μ£ΌκΈ° κ΄€λ¦¬
- `ChatTemplate`: Strategy Pattern κΈ°λ° ν…ν”λ¦Ώ μ‹μ¤ν…

#### μ„±λ¥ μµμ ν™”
- **μ„λ²„ μ‹μ‘μ‹ λ¨λΈ ν”„λ¦¬λ΅λ”©**: λ§¤ μ”μ²­λ§λ‹¤ λ΅λ”©ν•μ§€ μ•μ
- **μ •ν™•ν• ν† ν° κ³„μ‚°**: μ‹¤μ  ν† ν¬λ‚μ΄μ € κΈ°λ° usage μ •λ³΄
- **λ©”λ¨λ¦¬ ν¨μ¨μ  κ΄€λ¦¬**: 4.3GB λ©”λ¨λ¦¬ μƒμ£Όλ΅ μ¦‰μ‹ μ‘λ‹µ

#### μ„¤κ³„ ν¨ν„΄ μ μ©
- **Strategy Pattern**: `ChatTemplate` μ¶”μƒν™”λ΅ λ‹¤μ–‘ν• λ¨λΈ μ§€μ›
- **Factory Pattern**: `get_chat_template()`μΌλ΅ λ¨λΈλ³„ ν…ν”λ¦Ώ μ„ νƒ
- **μμ΅΄μ„± μ£Όμ…**: `ModelManager`λ΅ λ¨λΈ μƒνƒ κ΄€λ¦¬

#### μ§€μ› κΈ°λ¥
- **Qwen2.5-7B-Instruct** λ¨λΈ μ§€μ›
- **Chat Template** μλ™ λ³€ν™ (`<|im_start|>` ν•μ‹)
- **max_tokens** νλΌλ―Έν„° μ§€μ›
- **UUID κΈ°λ° κ³ μ  ID** μƒμ„±
- **Unix νƒ€μ„μ¤νƒ¬ν”„** κΈ°λ° μƒμ„± μ‹κ°„

#### κ°λ° κ³Όμ •μ—μ„ ν•™μµν• λ‚΄μ©
1. **MLX-LM νλΌλ―Έν„° μ μ•½**: `temperature`, `top_p` λ“±μ€ μ§μ ‘ μ§€μ›ν•μ§€ μ•μ
2. **FastAPI Startup Event**: `@app.on_event("startup")`μΌλ΅ μ΄κΈ°ν™” μ‘μ—…
3. **Pydantic vs λ”•μ…”λ„λ¦¬**: νƒ€μ… μ•μ „μ„±κ³Ό μλ™ κ²€μ¦μ μ¤‘μ”μ„±
4. **μ¶”μƒν™” μμ¤€**: ν•™μµμ© vs μ‹¤μ©μ„± κ°„μ νΈλ μ΄λ“μ¤ν”„

#### ν„μ¬ μ μ•½μ‚¬ν•­
- `temperature`, `top_p` νλΌλ―Έν„°λ” μ”μ²­μΌλ΅ λ°›μ§€λ§ λ‚΄λ¶€μ μΌλ΅ μ‚¬μ©λμ§€ μ•μ
- λ‹¨μΌ λ¨λΈ(Qwen2.5-7B)λ§ μ§€μ›
- λ™κΈ° μ²λ¦¬λ΅ λ€λ‰ μ”μ²­ μ‹ μ„±λ¥ μ΄μ μμƒ

---

## 2025-08-22 - Phase 2 κ³„ν: ν”„λ΅λ•μ… ν™κ²½ μ¤€λΉ„

### π― ν•΄κ²°ν•΄μ•Ό ν•  κ³Όμ λ“¤

#### 1. ν”„λ΅μ νΈ κµ¬μ΅° κ°μ„  
**ν„μ¬ λ¬Έμ :**
- `main.py` ν•λ‚μ— λ¨λ“  μ½”λ“ μ§‘μ¤‘ (200μ¤„ μ΄μƒ)
- μ μ§€λ³΄μμ„±κ³Ό ν™•μ¥μ„± μ μ•½

**ν•΄κ²° λ°©μ• κ²€ν† :**
```
μµμ… A - λ μ΄μ–΄λ³„ κµ¬μ΅°:
β”β”€β”€ api/
β”‚   β”β”€β”€ endpoints/
β”‚   β””β”€β”€ models/
β”β”€β”€ services/
β”β”€β”€ core/
β””β”€β”€ utils/

μµμ… B - κΈ°λ¥λ³„ κµ¬μ΅°:
β”β”€β”€ chat/
β”β”€β”€ models/
β”β”€β”€ templates/
β””β”€β”€ config/
```

**TODO:**
- [ ] ν”„λ΅μ νΈ κµ¬μ΅° λ°©μ‹ κ²°μ •
- [ ] μ½”λ“ λ¶„λ¦¬ λ° λ¦¬ν©ν† λ§
- [ ] import κ²½λ΅ μ •λ¦¬

#### 2. λ„¤νΈμ›ν¬ μ ‘κ·Όμ„± κµ¬μ„±
**μ”κµ¬μ‚¬ν•­:**
- λ‚μ¤ μ„λ²„ β†’ λ§¥λ¶ API μ„λ²„ ν†µμ‹  κ°€λ¥
- κ³µμ κΈ° λ‚΄λ¶€ λ„¤νΈμ›ν¬ ν™κ²½

**κ²€ν†  μ‚¬ν•­:**
- [ ] λ§¥λ¶ λ΅μ»¬ IP κ³ μ •
- [ ] ν¬νΈ ν¬μ›λ”© ν•„μ”μ„± κ²€ν†   
- [ ] λ°©ν™”λ²½ μ„¤μ • ν™•μΈ
- [ ] SSL/TLS μ μ© ν•„μ”μ„±
- [ ] API μΈμ¦ λ°©μ‹ κ²°μ •

#### 3. λ€λ‰ μ”μ²­ μ²λ¦¬ μ‹μ¤ν… μ„¤κ³„
**ν•µμ‹¬ μ”κµ¬μ‚¬ν•­:**
- 30λ¶„λ§λ‹¤ 100~150κ° μ½”μΈ κΈ°μ‚¬ λ¶„μ„ μ”μ²­
- κ° μ”μ²­μ€ μμ°¨μ μΌλ΅ μ „μ†΅λ¨

**μ„±λ¥ κ³ λ ¤μ‚¬ν•­:**
- ν„μ¬ λ‹¨μΌ μ”μ²­ μ²λ¦¬ μ‹κ°„: ~2-3μ΄ μ¶”μ •
- 150κ° * 3μ΄ = 7.5λ¶„ (μμ°¨ μ²λ¦¬μ‹)
- 30λ¶„ μ£ΌκΈ°λ¥Ό κ³ λ ¤ν•λ©΄ μ¶©λ¶„ν•μ§€λ§ μµμ ν™” μ—¬μ§€ μ΅΄μ¬

**κ²€ν† ν•  μ ‘κ·Ό λ°©μ‹:**
- [ ] **Queue μ‹μ¤ν…**: Redis/Celery κΈ°λ° λΉ„λ™κΈ° μ²λ¦¬
- [ ] **Connection Pooling**: MLX λ¨λΈ λ‹¤μ¤‘ μΈμ¤ν„΄μ¤
- [ ] **Rate Limiting**: μ„λ²„ λ³΄νΈλ¥Ό μ„ν• μ ν•
- [ ] **Batch Processing**: μ—¬λ¬ μ”μ²­μ„ λ¬¶μ–΄μ„ μ²λ¦¬
- [ ] **Streaming Response**: μ‹¤μ‹κ°„ μ‘λ‹µ μ¤νΈλ¦¬λ°

**μ¶”κ°€ κ³ λ ¤μ‚¬ν•­:**
- [ ] μ—λ¬ ν•Έλ“¤λ§ λ° μ¬μ‹λ„ λ΅μ§
- [ ] λ΅κΉ… λ° λ¨λ‹ν„°λ§ μ‹μ¤ν…
- [ ] λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μµμ ν™”
- [ ] μΊμ‹± μ „λµ (λ™μΌ μ”μ²­ μ¤‘λ³µ λ°©μ§€)

#### 4. λ΅κΉ… μ‹μ¤ν… κµ¬μ¶•
**ν„μ¬ λ¬Έμ :**
- λ‹¨μν• `print()` λ¬ΈμΌλ΅λ§ μ¶λ ¥
- λ΅κ·Έ λ λ²¨, νμΌ μ €μ¥, κµ¬μ΅°ν™”λ λ΅κΉ… λ¶€μ¬

**κµ¬ν„ν•΄μ•Ό ν•  κΈ°λ¥:**
- [ ] **κµ¬μ΅°ν™”λ λ΅κΉ…**: Python `logging` λ¨λ“ ν™μ©
- [ ] **λ΅κ·Έ λ λ²¨ κ΄€λ¦¬**: DEBUG, INFO, WARNING, ERROR
- [ ] **νμΌ λ΅κΉ…**: λ΅κ·Έ νμΌ μ €μ¥ λ° rotation
- [ ] **μ”μ²­ λ΅κΉ…**: API νΈμ¶ μ¶”μ  (μ”μ²­/μ‘λ‹µ μ‹κ°„, νλΌλ―Έν„°)
- [ ] **μ—λ¬ λ΅κΉ…**: μƒμ„Έν• μ—λ¬ μ •λ³΄ λ° μ¤νƒ νΈλ μ΄μ¤
- [ ] **μ„±λ¥ λ΅κΉ…**: λ¨λΈ μ¶”λ΅  μ‹κ°„, λ©”λ¨λ¦¬ μ‚¬μ©λ‰
- [ ] **JSON λ΅κΉ…**: κµ¬μ΅°ν™”λ λ΅κ·Έ ν¬λ§·μΌλ΅ λ¶„μ„ μ©μ΄μ„±

---

### π” λ‹¤μ μ°μ„ μμ„
1. **ν”„λ΅μ νΈ κµ¬μ΅° κ°μ„ ** (μ½”λ“ ν’μ§ ν–¥μƒ)
2. **λ΅κΉ… μ‹μ¤ν… κµ¬μ¶•** (μ΄μ κ°€μ‹μ„± ν™•λ³΄)
3. **λ„¤νΈμ›ν¬ μ„¤μ •** (μ—°κ²°μ„± ν™•λ³΄)  
4. **μ„±λ¥ μµμ ν™”** (λ€λ‰ μ²λ¦¬ λ€μ‘)

### π“ μ¶”κ°€ κ³ λ ¤μ‚¬ν•­
- Docker μ»¨ν…μ΄λ„ν™” κ²€ν† 
- ν™κ²½ λ³€μ κΈ°λ° μ„¤μ • κ΄€λ¦¬
- λ΅κ·Έ λ λ²¨ λ° νμΌ μ¶λ ¥
- Health check μ—”λ“ν¬μΈνΈ
- API λ¬Έμ„ μλ™ μƒμ„± (FastAPI Swagger)
